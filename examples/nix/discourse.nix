# discourse â€” generated by onix. Do not edit.
{ pkgs ? import <nixpkgs> {}, ruby ? pkgs.ruby_3_4 }:
let
  buildGem = import ./build-gem.nix { inherit pkgs ruby; };
  buildGemByName = name:
    let
      versions = import (./ruby + "/${name}.nix");
      version = builtins.head (builtins.attrNames versions);
      spec = versions.${version};
    in buildGem (spec // { gemName = name; });
  gemConfig = import ./gem-config.nix {
    inherit pkgs ruby;
    overlayDir = ../overlays;
    rubyDir = ./ruby;
    buildGemFn = buildGemByName;
  };

  build = name: version:
    let
      versions = import (./ruby + "/${name}.nix");
      spec = versions.${version};
      config = gemConfig.${name} or {};
    in buildGem (spec // {
      gemName = name;
      nativeBuildInputs = config.deps or [];
      extconfFlags = config.extconfFlags or "";
      beforeBuild = config.beforeBuild or "";
      afterBuild = config.afterBuild or "";
    } // (if config ? buildPhase then { inherit (config) buildPhase; } else {})
      // (if config ? postInstall then { inherit (config) postInstall; } else {})
      // (if config ? skip then { inherit (config) skip; } else {})
      // (if config ? buildGems then { inherit (config) buildGems; } else {}));

  gems = {
    Ascii85 = build "Ascii85" "2.0.1";
    actionmailer = build "actionmailer" "8.0.4";
    actionpack = build "actionpack" "8.0.4";
    actionview = build "actionview" "8.0.4";
    actionview_precompiler = build "actionview_precompiler" "0.4.0";
    active_model_serializers = build "active_model_serializers" "0.8.4";
    activejob = build "activejob" "8.0.4";
    activemodel = build "activemodel" "8.0.4";
    activerecord = build "activerecord" "8.0.4";
    activesupport = build "activesupport" "8.0.4";
    addressable = build "addressable" "2.8.8";
    afm = build "afm" "1.0.0";
    annotaterb = build "annotaterb" "4.20.0";
    ast = build "ast" "2.4.3";
    "aws-eventstream" = build "aws-eventstream" "1.4.0";
    "aws-partitions" = build "aws-partitions" "1.1134.0";
    "aws-sdk-core" = build "aws-sdk-core" "3.227.0";
    "aws-sdk-kms" = build "aws-sdk-kms" "1.99.0";
    "aws-sdk-mediaconvert" = build "aws-sdk-mediaconvert" "1.165.0";
    "aws-sdk-s3" = build "aws-sdk-s3" "1.182.0";
    "aws-sdk-sns" = build "aws-sdk-sns" "1.96.0";
    "aws-sigv4" = build "aws-sigv4" "1.12.1";
    base64 = build "base64" "0.3.0";
    better_errors = build "better_errors" "2.10.1";
    bigdecimal = build "bigdecimal" "3.3.1";
    binding_of_caller = build "binding_of_caller" "1.0.1";
    bootsnap = build "bootsnap" "1.19.0";
    builder = build "builder" "3.3.0";
    bullet = build "bullet" "8.1.0";
    capybara = build "capybara" "3.40.0";
    "capybara-playwright-driver" = build "capybara-playwright-driver" "0.5.7";
    cbor = build "cbor" "0.5.10.1";
    certified = build "certified" "1.0.0";
    chunky_png = build "chunky_png" "1.4.0";
    coderay = build "coderay" "1.1.3";
    colored2 = build "colored2" "4.0.3";
    "concurrent-ruby" = build "concurrent-ruby" "1.3.5";
    connection_pool = build "connection_pool" "2.5.5";
    cose = build "cose" "1.3.1";
    cppjieba_rb = build "cppjieba_rb" "0.4.4";
    crack = build "crack" "1.0.1";
    crass = build "crass" "1.0.6";
    css_parser = build "css_parser" "1.21.1";
    csv = build "csv" "3.3.5";
    debug = build "debug" "1.11.0";
    debug_inspector = build "debug_inspector" "1.2.0";
    "diff-lcs" = build "diff-lcs" "1.6.2";
    diffy = build "diffy" "3.4.4";
    "digest-xxhash" = build "digest-xxhash" "0.2.9";
    "discourse-emojis" = build "discourse-emojis" "1.0.44";
    "discourse-fonts" = build "discourse-fonts" "0.0.19";
    "discourse-seed-fu" = build "discourse-seed-fu" "2.3.12";
    "discourse_ai-tokenizers" = build "discourse_ai-tokenizers" "0.4";
    discourse_dev_assets = build "discourse_dev_assets" "0.0.6";
    discourse_math_bundle = build "discourse_math_bundle" "1.0.1";
    docile = build "docile" "1.4.1";
    drb = build "drb" "2.2.3";
    "dry-initializer" = build "dry-initializer" "3.2.0";
    ed25519 = build "ed25519" "1.4.0";
    email_reply_trimmer = build "email_reply_trimmer" "0.2.0";
    erubi = build "erubi" "1.13.1";
    excon = build "excon" "1.3.2";
    exifr = build "exifr" "1.4.1";
    "extralite-bundle" = build "extralite-bundle" "2.13";
    fabrication = build "fabrication" "3.0.0";
    faker = build "faker" "3.5.3";
    faraday = build "faraday" "2.14.0";
    "faraday-multipart" = build "faraday-multipart" "1.1.1";
    "faraday-net_http" = build "faraday-net_http" "3.4.2";
    "faraday-retry" = build "faraday-retry" "2.3.2";
    fast_blank = build "fast_blank" "1.0.1";
    fastimage = build "fastimage" "2.3.1";
    ffi = build "ffi" "1.17.2";
    fspath = build "fspath" "3.1.2";
    globalid = build "globalid" "1.3.0";
    goldiloader = build "goldiloader" "6.0.0";
    "google-protobuf" = build "google-protobuf" "4.33.2";
    guess_html_encoding = build "guess_html_encoding" "0.0.11";
    hana = build "hana" "1.3.7";
    hashdiff = build "hashdiff" "1.2.1";
    hashery = build "hashery" "2.1.2";
    hashie = build "hashie" "5.0.0";
    highline = build "highline" "3.1.2";
    htmlentities = build "htmlentities" "4.4.2";
    http_accept_language = build "http_accept_language" "2.1.1";
    i18n = build "i18n" "1.14.7";
    image_optim = build "image_optim" "0.31.4";
    image_size = build "image_size" "3.4.0";
    in_threads = build "in_threads" "1.6.0";
    inflection = build "inflection" "1.0.0";
    iso8601 = build "iso8601" "0.13.0";
    jmespath = build "jmespath" "1.6.2";
    "json-schema" = build "json-schema" "6.0.0";
    json_schemer = build "json_schemer" "2.5.0";
    jwt = build "jwt" "2.10.1";
    kgio = build "kgio" "2.11.4";
    "language_server-protocol" = build "language_server-protocol" "3.17.0.5";
    "libv8-node" = build "libv8-node" "24.1.0.0";
    lint_roller = build "lint_roller" "1.1.0";
    listen = build "listen" "3.9.0";
    literate_randomizer = build "literate_randomizer" "0.4.0";
    lograge = build "lograge" "0.14.0";
    "logstash-event" = build "logstash-event" "1.2.02";
    logster = build "logster" "2.20.1";
    loofah = build "loofah" "2.24.1";
    lru_redux = build "lru_redux" "1.1.0";
    "lz4-ruby" = build "lz4-ruby" "0.3.3";
    mail = build "mail" "2.9.0";
    matrix = build "matrix" "0.4.3";
    maxminddb = build "maxminddb" "0.1.22";
    memory_profiler = build "memory_profiler" "1.1.0";
    message_bus = build "message_bus" "4.5.1";
    "messageformat-wrapper" = build "messageformat-wrapper" "1.1.0";
    method_source = build "method_source" "1.1.0";
    "mime-types" = build "mime-types" "3.7.0";
    "mime-types-data" = build "mime-types-data" "3.2025.0924";
    mini_mime = build "mini_mime" "1.1.5";
    mini_racer = build "mini_racer" "0.19.1";
    mini_scheduler = build "mini_scheduler" "0.18.0";
    mini_sql = build "mini_sql" "1.6.0";
    mini_suffix = build "mini_suffix" "0.3.3";
    minio_runner = build "minio_runner" "1.0.0";
    minitest = build "minitest" "5.26.2";
    mocha = build "mocha" "2.8.2";
    msgpack = build "msgpack" "1.8.0";
    multi_json = build "multi_json" "1.18.0";
    multi_xml = build "multi_xml" "0.7.2";
    "multipart-post" = build "multipart-post" "2.4.1";
    mustache = build "mustache" "1.1.1";
    "net-imap" = build "net-imap" "0.5.12";
    "net-pop" = build "net-pop" "0.1.2";
    "net-smtp" = build "net-smtp" "0.5.1";
    nio4r = build "nio4r" "2.7.5";
    nokogiri = build "nokogiri" "1.18.10";
    oauth = build "oauth" "1.1.3";
    "oauth-tty" = build "oauth-tty" "1.0.6";
    oauth2 = build "oauth2" "1.4.11";
    octokit = build "octokit" "5.6.1";
    oj = build "oj" "3.16.12";
    omniauth = build "omniauth" "2.1.2";
    "omniauth-facebook" = build "omniauth-facebook" "9.0.0";
    "omniauth-github" = build "omniauth-github" "2.0.0";
    "omniauth-google-oauth2" = build "omniauth-google-oauth2" "1.0.1";
    "omniauth-oauth" = build "omniauth-oauth" "1.2.1";
    "omniauth-oauth2" = build "omniauth-oauth2" "1.7.3";
    "omniauth-twitter" = build "omniauth-twitter" "1.4.0";
    "openssl-signature_algorithm" = build "openssl-signature_algorithm" "1.3.0";
    optimist = build "optimist" "3.2.1";
    parallel = build "parallel" "1.27.0";
    parallel_tests = build "parallel_tests" "5.5.0";
    parser = build "parser" "3.3.10.0";
    pastel = build "pastel" "0.8.0";
    "pdf-reader" = build "pdf-reader" "2.15.0";
    pg = build "pg" "1.6.2";
    pitchfork = build "pitchfork" "0.18.1";
    "playwright-ruby-client" = build "playwright-ruby-client" "1.57.0";
    prettier_print = build "prettier_print" "1.2.1";
    progress = build "progress" "3.6.0";
    propshaft = build "propshaft" "1.3.1";
    pry = build "pry" "0.15.2";
    "pry-rails" = build "pry-rails" "0.3.11";
    "pry-stack_explorer" = build "pry-stack_explorer" "0.6.1";
    public_suffix = build "public_suffix" "7.0.0";
    puma = build "puma" "7.1.0";
    racc = build "racc" "1.8.1";
    rack = build "rack" "2.2.21";
    "rack-mini-profiler" = build "rack-mini-profiler" "4.0.1";
    "rack-protection" = build "rack-protection" "3.2.0";
    "rack-session" = build "rack-session" "1.0.2";
    "rack-test" = build "rack-test" "2.2.0";
    rackup = build "rackup" "1.0.1";
    "rails-dom-testing" = build "rails-dom-testing" "2.3.0";
    "rails-html-sanitizer" = build "rails-html-sanitizer" "1.6.2";
    rails_failover = build "rails_failover" "2.3.0";
    rails_multisite = build "rails_multisite" "7.0.0";
    railties = build "railties" "8.0.4";
    rainbow = build "rainbow" "3.1.1";
    raindrops = build "raindrops" "0.20.1";
    rake = build "rake" "13.3.1";
    "rake-compiler-dock" = build "rake-compiler-dock" "1.10.0";
    "rb-fsevent" = build "rb-fsevent" "0.11.2";
    "rb-inotify" = build "rb-inotify" "0.11.1";
    rb_sys = build "rb_sys" "0.9.119";
    rbs = build "rbs" "3.9.5";
    rbtrace = build "rbtrace" "0.5.3";
    rchardet = build "rchardet" "1.10.0";
    redcarpet = build "redcarpet" "3.6.1";
    redis = build "redis" "5.4.0";
    "redis-client" = build "redis-client" "0.26.1";
    "redis-namespace" = build "redis-namespace" "1.11.0";
    regexp_parser = build "regexp_parser" "2.11.3";
    request_store = build "request_store" "1.7.0";
    rexml = build "rexml" "3.4.4";
    rinku = build "rinku" "2.0.6";
    rotp = build "rotp" "6.3.0";
    rouge = build "rouge" "4.7.0";
    rqrcode = build "rqrcode" "3.1.1";
    rqrcode_core = build "rqrcode_core" "2.0.1";
    rrule = build "rrule" "0.7.0";
    rspec = build "rspec" "3.13.2";
    "rspec-core" = build "rspec-core" "3.13.6";
    "rspec-expectations" = build "rspec-expectations" "3.13.5";
    "rspec-html-matchers" = build "rspec-html-matchers" "0.10.0";
    "rspec-mocks" = build "rspec-mocks" "3.13.7";
    "rspec-multi-mock" = build "rspec-multi-mock" "0.3.1";
    "rspec-rails" = build "rspec-rails" "8.0.2";
    "rspec-support" = build "rspec-support" "3.13.6";
    rss = build "rss" "0.3.1";
    "rswag-specs" = build "rswag-specs" "2.17.0";
    rtlcss = build "rtlcss" "0.2.1";
    rubocop = build "rubocop" "1.81.7";
    "rubocop-ast" = build "rubocop-ast" "1.48.0";
    "rubocop-capybara" = build "rubocop-capybara" "2.22.1";
    "rubocop-discourse" = build "rubocop-discourse" "3.13.3";
    "rubocop-factory_bot" = build "rubocop-factory_bot" "2.28.0";
    "rubocop-rails" = build "rubocop-rails" "2.33.4";
    "rubocop-rspec" = build "rubocop-rspec" "3.8.0";
    "rubocop-rspec_rails" = build "rubocop-rspec_rails" "2.32.0";
    "ruby-lsp" = build "ruby-lsp" "0.26.4";
    "ruby-lsp-rails" = build "ruby-lsp-rails" "0.4.8";
    "ruby-lsp-rspec" = build "ruby-lsp-rspec" "0.1.28";
    "ruby-prof" = build "ruby-prof" "1.7.2";
    "ruby-progressbar" = build "ruby-progressbar" "1.13.0";
    "ruby-rc4" = build "ruby-rc4" "0.1.5";
    "ruby-readability" = build "ruby-readability" "0.7.2";
    rubyzip = build "rubyzip" "2.4.1";
    sanitize = build "sanitize" "7.0.0";
    "sass-embedded" = build "sass-embedded" "1.91.0";
    "sassc-embedded" = build "sassc-embedded" "1.80.5";
    sawyer = build "sawyer" "0.9.3";
    "shoulda-matchers" = build "shoulda-matchers" "7.0.1";
    sidekiq = build "sidekiq" "7.3.9";
    simplecov = build "simplecov" "0.22.0";
    "simplecov-html" = build "simplecov-html" "0.13.2";
    simplecov_json_formatter = build "simplecov_json_formatter" "0.1.4";
    simpleidn = build "simpleidn" "0.2.3";
    snaky_hash = build "snaky_hash" "2.0.3";
    sqlite3 = build "sqlite3" "2.8.1";
    sshkey = build "sshkey" "3.0.0";
    stackprof = build "stackprof" "0.2.27";
    stripe = build "stripe" "11.1.0";
    syntax_tree = build "syntax_tree" "6.3.0";
    "test-prof" = build "test-prof" "1.5.0";
    thor = build "thor" "1.4.0";
    tiktoken_ruby = build "tiktoken_ruby" "0.0.15.1";
    tokenizers = build "tokenizers" "0.6.3";
    trilogy = build "trilogy" "2.9.0";
    ttfunk = build "ttfunk" "1.8.0";
    "tty-color" = build "tty-color" "0.6.0";
    "tty-cursor" = build "tty-cursor" "0.7.1";
    "tty-prompt" = build "tty-prompt" "0.23.1";
    "tty-reader" = build "tty-reader" "0.9.0";
    "tty-screen" = build "tty-screen" "0.8.2";
    tzinfo = build "tzinfo" "2.0.6";
    "tzinfo-data" = build "tzinfo-data" "1.2025.2";
    unf = build "unf" "0.2.0";
    "unicode-display_width" = build "unicode-display_width" "3.2.0";
    "unicode-emoji" = build "unicode-emoji" "4.1.0";
    unicorn = build "unicorn" "6.1.0";
    uniform_notifier = build "uniform_notifier" "1.18.0";
    useragent = build "useragent" "0.16.11";
    version_gem = build "version_gem" "1.1.9";
    "web-push" = build "web-push" "3.0.1";
    webmock = build "webmock" "3.25.1";
    webrick = build "webrick" "1.9.2";
    wisper = build "wisper" "2.0.1";
    xpath = build "xpath" "3.2.0";
    "yaml-lint" = build "yaml-lint" "0.1.2";
    yard = build "yard" "0.9.38";
    zeitwerk = build "zeitwerk" "2.7.3";
    zendesk_api = build "zendesk_api" "1.38.0.rc1";
  };

  bundlePath = pkgs.buildEnv {
    name = "discourse-bundle";
    paths = builtins.attrValues gems;
  };
in gems // {
  inherit bundlePath;
  devShell = { buildInputs ? [], shellHook ? "", ... }@args:
    pkgs.mkShell (builtins.removeAttrs args ["buildInputs" "shellHook"] // {
      name = "discourse-devshell";
      buildInputs = [ ruby ] ++ buildInputs;
      shellHook = ''
        export BUNDLE_PATH="${bundlePath}"
        export BUNDLE_GEMFILE="''${BUNDLE_GEMFILE:-$PWD/Gemfile}"
        export GEM_PATH="${bundlePath}/ruby/${ruby.version.majMinTiny}''${GEM_PATH:+:$GEM_PATH}"
      '' + shellHook;
    });
}
