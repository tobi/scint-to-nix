#!/usr/bin/env bash
set -euo pipefail

dir="$(cd "$(dirname "$0")" && pwd)"
app_dir="/tmp/onix-tests/spree"

if [ ! -d "$app_dir" ]; then
  echo "Cloning spree to $app_dir..."
  git clone --depth 1 https://github.com/spree/spree.git "$app_dir"
fi

cd "$app_dir"

exec nix-shell "$dir/devshell.nix" --run "
  ruby -e 'require \"spree/core\"; puts(1 + 1)'
  echo 'spree: require OK'
"
